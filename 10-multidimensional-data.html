<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Image Processing with Python: Multidimensional data</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav data"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="dc-logo" alt="Data Carpentry" src="assets/images/data-logo.svg"></div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/10-multidimensional-data.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="assets/images/data-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Image Processing with Python
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Image Processing with Python
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="edge-detection.html">Extra Episode: Edge Detection</a></li><li><a class="dropdown-item" href="prereqs.html">Prerequisites</a></li><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Image Processing with Python
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 85%" class="percentage">
    85%
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: 85%" aria-valuenow="85" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/10-multidimensional-data.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-introduction.html">1. Introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-image-basics.html">2. Image Basics</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-skimage-images.html">3. Working with scikit-image</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-drawing.html">4. Drawing and Bitwise Operations</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-creating-histograms.html">5. Creating Histograms</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-blurring.html">6. Blurring Images</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-thresholding.html">7. Thresholding</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-connected-components.html">8. Connected Component Analysis</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="09-challenges.html">9. Capstone Challenge</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        10. Multidimensional data
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#first-import-the-packages-needed-for-this-episode">First, import the packages needed for this episode</a></li>
<li><a href="#what-is-multidimensional-image-data">What is multidimensional image data?</a></li>
<li><a href="#interactive-image-visualisation-with-napari">Interactive image visualisation with Napari</a></li>
<li><a href="#processing-3d-volumetric-data">Processing 3D volumetric data</a></li>
<li><a href="#processing-timelapse-movies">Processing timelapse movies</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="discuss.html">Discussion</a></li><li><a href="edge-detection.html">Extra Episode: Edge Detection</a></li><li><a href="prereqs.html">Prerequisites</a></li><li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="09-challenges.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="09-challenges.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Capstone Challenge
        </a>
        <a class="chapter-link float-end" href="index.html" rel="next">
          Home
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Multidimensional data</h1>
        <p>Last updated on 2024-01-26 |

        <a href="https://github.com/datacarpentry/image-processing/edit/main/episodes/10-multidimensional-data.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can we use scikit-image to perform image processing tasks on
multidimensional image data?</li>
<li>How can we visualise the results using Napari?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Learn about multidimensional image data such as 3D volumetric stacks
and timelapses.</li>
<li>Visualize multidimensional data interactively using Napari.</li>
<li>Learn to use the basic functionality of the Napari user interface
including overlaying masks over images.</li>
<li>Construct an analysis workflow to measure the properties of 3D
objects in a volumetric image stack.</li>
<li>Construct an analysis workflow to measure changes over time from a
timelapse movie.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>In this episode we will move beyond 2D RGB image data and learn how
to process and visualise multidimensional image data including 3D
volumes and timelapse movies.</p>
<div id="unofficial-episode" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="unofficial-episode" class="callout-inner">
<h3 class="callout-title">Unofficial episode</h3>
<div class="callout-content">
<p>This additional episode is not part of the official <a href="https://datacarpentry.org/image-processing/" class="external-link">Carpentries Image
Processing with Python Lesson</a>. It was developed by <a href="https://www.birmingham.ac.uk/research/arc/rsg/staff/jeremy-pike.aspx" class="external-link">Jeremy
Pike</a> from the <a href="https://www.birmingham.ac.uk/research/arc/rsg/bear-software.aspx" class="external-link">Research
Software Group</a> and the <a href="https://www.birmingham.ac.uk/research/data-science/index.aspx" class="external-link">Institute
for Interdisciplinary Data Science and AI</a> at the University of
Birmingham.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="first-import-the-packages-needed-for-this-episode">First, import the packages needed for this episode<a class="anchor" aria-label="anchor" href="#first-import-the-packages-needed-for-this-episode"></a></h2>
<hr class="half-width"><div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> imageio.v3 <span class="im">as</span> iio</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">import</span> skimage <span class="im">as</span> ski</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="im">import</span> napari</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="op">%</span>matplotlib</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>widget</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="what-is-multidimensional-image-data">What is multidimensional image data?<a class="anchor" aria-label="anchor" href="#what-is-multidimensional-image-data"></a></h2>
<hr class="half-width"><p>Image data is often more complex than individual 2D (xy) images and
can have additional dimensionality and structure. Such multidimensional
image data has many flavours including multichannel, 3D volumes and
timelapse movies. It is possible to combine these flavours to produce
higher n-dimensional data. For example a volumetric, multichannel,
timelapse dataset would have a 5D (2+1+1+1) structure.</p>
<div class="section level3">
<h3 id="multichannel-image-data">Multichannel image data<a class="anchor" aria-label="anchor" href="#multichannel-image-data"></a></h3>
<p>In many applications we can have different 2D images, or channels, of
the same spatial area. We have already seen a simple example of this in
RGB colour images where we have 3 channels representing the red, green
and blue components. Another example is in fluorescence microscopy where
we could have images of different proteins. Modern techniques often
allow for acquisition of more than 3 channels.</p>
</div>
<div class="section level3">
<h3 id="d-volumetric-data">3D volumetric data<a class="anchor" aria-label="anchor" href="#d-volumetric-data"></a></h3>
<p>Volumetric image data consists of an ordered sequence of 2D images
(or slices) where each slice corresponds to a, typically evenly spaced,
axial position. Such data is common in biomedical applications for
example CT or MRI where it is used to reconstruct 3D volumes of organs
such as the brain or heart.</p>
</div>
<div class="section level3">
<h3 id="timelapse-movies">Timelapse movies<a class="anchor" aria-label="anchor" href="#timelapse-movies"></a></h3>
<p>Timelapse movies are commonplace in everyday life. When you take a
movie on your phone your acquire an ordered sequence of 2D images (or
timepoints/frames) where each image corresponds to a specific point in
time. Timelapse data is also common in scientific applications where we
want to quantify changes over time. For example imaging the growth of
cell cultures, bacterial colonies or plant roots over time.</p>
</div>
</section><section><h2 class="section-heading" id="interactive-image-visualisation-with-napari">Interactive image visualisation with Napari<a class="anchor" aria-label="anchor" href="#interactive-image-visualisation-with-napari"></a></h2>
<hr class="half-width"><p>In the previous episodes we used
<code>matplotlib.pyplot.imshow()</code> to display images. This is
suitable for basic visualisation of 2D multichannel image data but not
well suited for more complex tasks such as:</p>
<ol style="list-style-type: decimal"><li>Interactive visualisation such as on-the-fly zooming in and out,
rotation and toggling between channels.</li>
<li>Interactive image annotation. In <a href="04-drawing.html">the
<em>Drawing</em> episode</a> we used functions such as
<code>ski.draw.rectangle()</code> to programmatically annotate images
but not in an interactive user-friendly way.</li>
<li>Visualising 3D volumetric data either by toggling between slices or
though a 3D rendering.</li>
<li>Visualising timelapse movies where the movie can be played and
paused at specific timepoints.</li>
<li>Visualising complex higher order data (more than 3 dimensions) such
as timelapse, volumetric multichannel images.</li>
</ol><p><a href="https://napari.org/stable/tutorials/fundamentals/quick_start.html" class="external-link">Napari</a>
is a Python library for fast visualisation, annotation and analysis of
n-dimensional image data. At its core is the <a href="https://napari.org/stable/api/napari.Viewer.html#napari.Viewer" class="external-link"><code>napari.Viewer</code>
class</a>. Creating a Viewer instance within a notebook will launch a
Napari Graphical User Interface (GUI) wih two-way communication between
the notebook and the GUI:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>viewer <span class="op">=</span> napari.Viewer()</span></code></pre>
</div>
<p>The Napari Viewer displays data through <a href="https://napari.org/stable/api/napari.layers.html" class="external-link">Layers</a>.
There are different Layer subclasses for different types of data.
<code>Image</code> Layers are for image data and <code>Label</code>
Layers are for masks/segmentations. There are also Layer subclasses for
<code>Points</code>, <code>Shapes</code>, <code>Surfaces</code> etc.
Let’s load two RGB images and add them to the Viewer as
<code>Image</code> Layers:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>colonies_01 <span class="op">=</span> iio.imread(uri<span class="op">=</span><span class="st">"data/colonies-01.tif"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>colonies_02 <span class="op">=</span> iio.imread(uri<span class="op">=</span><span class="st">"data/colonies-02.tif"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>viewer.add_image(data<span class="op">=</span>colonies_01, name<span class="op">=</span><span class="st">"colonies_01"</span>, rgb<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>viewer.add_image(data<span class="op">=</span>colonies_02, name<span class="op">=</span><span class="st">"colonies_02"</span>, rgb<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>napari.utils.nbscreenshot(viewer)</span></code></pre>
</div>
<figure><img src="fig/colonies-napari.png" alt="colonies napari ss" class="figure mx-auto d-block"></figure><p>Here we use the <code>viewer.add_image()</code> function to add
<code>Image</code> Layers to the Viewer. We set <code>rgb=True</code> to
display the three channel image as RGB. The
<code>napari.utils.nbscreenshot()</code> function outputs a screenshot
of the Viewer to the notebook. Now lets look at some multichannel image
data:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>cells <span class="op">=</span> iio.imread(uri<span class="op">=</span><span class="st">"data/FluorescentCells.tif"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="bu">print</span>(cells.shape)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(3, 474, 511)</code></pre>
</div>
<p>Like RGB data this image of cells also has three channels (stored in
the first dimension of the NumPy array). However, in this case we may
want to visualise each channel independently. To do this we do not set
<code>rgb=True</code> when adding the <code>Image</code> Layer:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>viewer.layers.clear()</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>viewer.add_image(data<span class="op">=</span>cells, name<span class="op">=</span><span class="st">"cells"</span>)</span></code></pre>
</div>
<figure><img src="fig/cells-napari.png" alt="cells napari ss" class="figure mx-auto d-block"></figure><div id="clearing-the-napari-viewer" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="clearing-the-napari-viewer" class="callout-inner">
<h3 class="callout-title">Clearing the Napari Viewer</h3>
<div class="callout-content">
<p>When we want to close all Layers in a Viewer instance we can use
<code>viewer.layers.clear()</code>. This allows us to start fresh,
alternatively we could close the existing Viewer and open a new one with
<code>viewer = napari.Viewer()</code>. We will use the first approach
throughout this Episode but if any point you accidentally close the
Viewer you can just open a new one.</p>
</div>
</div>
</div>
<p>We can now scroll through the channels within Napari using the slider
just below the image. This approach will work with an arbitrary number
of channels, not just three. With multichannel data it is common to
visualise colour overlays of selected channels where each channel has a
different colour map. In Napari we can do this programmatically using
the <code>channel_axis</code> variable:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>viewer.layers.clear()</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>viewer.add_image(data<span class="op">=</span>cells, name<span class="op">=</span>[<span class="st">"membrane"</span>, <span class="st">"cytoplasm"</span>, <span class="st">"nucleus"</span>], channel_axis<span class="op">=</span><span class="dv">0</span>)</span></code></pre>
</div>
<figure><img src="fig/cells-seperate-napari.png" alt="cells seperate napari ss" class="figure mx-auto d-block"></figure><p>Using what we have learnt in the previous Episodes let’s segment the
nuclei . First we produce a binary mask of the nuclei by blurring the
nuclei channel image and thresholding with the Otsu approach.
Subsequently, we label the connected components within the mask to
identify individual nuclei:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>blurred_nuclei <span class="op">=</span> ski.filters.gaussian(cells[<span class="dv">2</span>], sigma<span class="op">=</span><span class="fl">2.0</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>t <span class="op">=</span> ski.filters.threshold_otsu(blurred_nuclei)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>nuclei_mask <span class="op">=</span> blurred_nuclei <span class="op">&gt;</span> t</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>nuclei_labels <span class="op">=</span> ski.measure.label(nuclei_mask, connectivity<span class="op">=</span><span class="dv">2</span>, return_num<span class="op">=</span><span class="va">False</span>)</span></code></pre>
</div>
<p>Now lets display the nuclei channel and overlay the labels within
Napari using a <code>Label</code> layer:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>viewer.layers.clear()</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>viewer.add_image(data<span class="op">=</span>cells[<span class="dv">2</span>], name<span class="op">=</span><span class="st">"nuclei"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>viewer.add_labels(data<span class="op">=</span>nuclei_labels, name<span class="op">=</span><span class="st">"nuclei_labels"</span>)</span></code></pre>
</div>
<figure><img src="fig/nuc-napari.png" alt="nuclei napari ss" class="figure mx-auto d-block"></figure><p>We can also interactively annotate images with shapes using a
<code>Shapes</code> Layer. Let’s display all three channels and then do
this within the GUI:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>viewer.layers.clear()</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>viewer.add_image(data<span class="op">=</span>cells, name<span class="op">=</span><span class="st">"cells"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co"># the instructor will demonstrate how to add a `Shapes` Layer and draw around cells using polygons</span></span></code></pre>
</div>
<figure><img src="fig/shapes-napari.png" alt="shapes napari ss" class="figure mx-auto d-block"></figure><div id="using-napari-as-an-image-viewer-20-min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="using-napari-as-an-image-viewer-20-min" class="callout-inner">
<h3 class="callout-title">Using Napari as an image viewer (20 min)</h3>
<div class="callout-content">
<p>In <a href="09-challenges.html">the <em>Capstone challenge</em>
episode</a> you made a function to count the number of bacteria colonies
in an image also producing a new image that highlights the colonies.
Modify this function to make use of Napari, as opposed to
<code>Matplotlib</code>, to display both the original colony image and
the segmented individual colonies. Test this new function on
<code>"data/colonies-03.tif"</code>. If you did not complete the
<em>Capstone challenge</em> epsidode you can start with function from
the <a href="09-challenges.html#colony-counting-with-minimum-size-and-automated-threshold-optional-not-included-in-timing">solution</a>.
Hints:</p>
<ol style="list-style-type: decimal"><li>A <code>napari.Viewer</code> object should be passed to the function
as an input parameter.</li>
<li>The original image should be added to the Viewer as an
<code>Image</code> Layer.</li>
<li>The labelled colony image should be to the Viewer as an
<code>Label</code> Layer.</li>
</ol></div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Your new function might look something like this:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="kw">def</span> count_colonies_napari(image_filename, viewer, sigma<span class="op">=</span><span class="fl">1.0</span>, min_colony_size<span class="op">=</span><span class="dv">10</span>, connectivity<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  bacteria_image <span class="op">=</span> iio.imread(image_filename)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  gray_bacteria <span class="op">=</span> ski.color.rgb2gray(bacteria_image)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  blurred_image <span class="op">=</span> ski.filters.gaussian(gray_bacteria, sigma<span class="op">=</span>sigma)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  <span class="co"># create mask excluding the very bright pixels outside the dish</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>  <span class="co"># we dont want to include these when calculating the automated threshold</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>  mask <span class="op">=</span> blurred_image <span class="op">&lt;</span> <span class="fl">0.90</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>  <span class="co"># calculate an automated threshold value within the dish using the Otsu method</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>  t <span class="op">=</span> ski.filters.threshold_otsu(blurred_image[mask])</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>  <span class="co"># update mask to select pixels both within the dish and less than t</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>  mask <span class="op">=</span> np.logical_and(mask, blurred_image <span class="op">&lt;</span> t)</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>  <span class="co"># remove objects smaller than specified area</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>  mask <span class="op">=</span> ski.morphology.remove_small_objects(mask, min_size<span class="op">=</span>min_colony_size)</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>  labeled_image, count <span class="op">=</span> ski.measure.label(mask, return_num<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss"> colonies in </span><span class="sc">{</span>image_filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>  <span class="co"># add the orginal image (RGB) to the Napari Viewer</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>  viewer.add_image(data<span class="op">=</span>bacteria_image, name<span class="op">=</span><span class="st">"bacteria"</span>, rgb<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a>  <span class="co"># add the labeled image to the Napari Viewer</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a>  viewer.add_labels(data<span class="op">=</span>labeled_image, name<span class="op">=</span><span class="st">"colony masks"</span>)</span></code></pre>
</div>
<p>To run this function on <code>"data/colonies-03.tif"</code>:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>viewer.layers.clear()  <span class="co"># or viewer = napari.Viewer() if you want a new Viewer</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>count_colonies_napari(image_filename<span class="op">=</span><span class="st">"data/colonies-03.tif"</span>, viewer<span class="op">=</span>viewer)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>There are 260 colonies in data/colonies-03.tif</code></pre>
</div>
<figure><img src="fig/colonies-03-napari.png" alt="colonies napari 3 ss" class="figure mx-auto d-block"></figure></div>
</div>
</div>
</div>
<div id="learning-to-use-the-napari-gui-optional-not-included-in-timing" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="learning-to-use-the-napari-gui-optional-not-included-in-timing" class="callout-inner">
<h3 class="callout-title">Learning to use the Napari GUI (optional, not included in timing)</h3>
<div class="callout-content">
<p>Take some time to further familiarize yourself with the Napari GUI.
You could load some of the course images and experiment with different
features, or alternatively you could take a look at the official <a href="https://napari.org/stable/tutorials/fundamentals/viewer.html" class="external-link">Viewer
tutorial</a>.</p>
</div>
</div>
</div>
<div id="napari-plugins" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="napari-plugins" class="callout-inner">
<h3 class="callout-title">Napari plugins</h3>
<div class="callout-content">
<p><a href="https://napari.org/stable/plugins/index.html" class="external-link">Plugins</a>
extend Napari’s core functionally and allow you to add lots of cool and
advanced features. There is an ever-increasing number of Napari plugins
which are available from the <a href="https://www.napari-hub.org/" class="external-link">Napari hub</a>. For example:</p>
<ul><li>
<a href="https://www.napari-hub.org/plugins/napari-animation" class="external-link">napari-animation</a>
for making video annotations with key frames.</li>
<li>
<a href="https://www.napari-hub.org/plugins/napari-segment-blobs-and-things-with-membranes" class="external-link">napari-segment-blobs-and-things-with-membranes</a>
for adding common image processing operations to the Tools menu.</li>
<li>
<a href="https://www.napari-hub.org/plugins/napari-skimage-regionprops" class="external-link">napari-skimage-regionprops</a>
for measuring the properties of connected components from
<code>Label</code> Layers.</li>
<li>
<a href="https://www.napari-hub.org/plugins/napari-pyclesperanto-assistant" class="external-link">napari-pyclesperanto-assistant</a>
for GPU-accelerated image processing operations.</li>
<li>
<a href="https://www.napari-hub.org/plugins/napari-clusters-plotter" class="external-link">napari-clusters-plotter</a>
for clustering objects according to their properties including
dimensionality reduction techniques like PCA and UMAP.</li>
<li>
<a href="https://www.napari-hub.org/plugins/napari-accelerated-pixel-and-object-classification" class="external-link">napari-acceleration-pixel-and-object-classification</a>
for Random Forest-based pixel and object classification.</li>
<li>
<a href="https://www.napari-hub.org/plugins/cellpose-napari" class="external-link">cellpose-napari</a>
and <a href="https://www.napari-hub.org/plugins/stardist-napari" class="external-link">stardist-napari</a>
for pretrained deep learning-based models to segment cells and
nuclei.</li>
<li>
<a href="https://www.napari-hub.org/plugins/napari-n2v" class="external-link">napari-n2v</a> for
self-supervised deep learning-based denosing.</li>
<li>
<a href="https://www.napari-hub.org/plugins/napari-assistant" class="external-link">napari-assistant</a>,
a meta-plugin for building image processing workflows.</li>
</ul></div>
</div>
</div>
<div id="getting-help-on-image.sc" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="getting-help-on-image.sc" class="callout-inner">
<h3 class="callout-title">Getting help on image.sc</h3>
<div class="callout-content">
<p><a href="https://forum.image.sc/" class="external-link">image.sc</a> is a community forum
for all software-oriented aspects of scientific imaging, particularly
(but not limited to) image analysis, processing, acquisition, storage,
and management. Its great place to get help and ask questions which are
either general or specific to a particular tool. There are active
sections for <a href="https://forum.image.sc/tag/python" class="external-link">python</a>, <a href="https://forum.image.sc/tag/scikit-image" class="external-link">scikit-image</a> and <a href="https://forum.image.sc/tag/napari" class="external-link">Napari</a>.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="processing-3d-volumetric-data">Processing 3D volumetric data<a class="anchor" aria-label="anchor" href="#processing-3d-volumetric-data"></a></h2>
<hr class="half-width"><p>Recall that 3D volumetric data consists of an ordered sequence of
images, or slices, each corresponding to a specific axial position. As
an example lets work with <code>skimage.data.cells3d()</code>which is a
3D fluorescence microscopy image stack. From the <a href="https://scikit-image.org/docs/stable/api/skimage.data.html#skimage.data.cells3d" class="external-link">dataset
documentation</a> we can see that the data has two channels (0:
membrane, 1: nuclei). The dimensions are ordered
<code>(z, channels, y, x)</code> and each voxel has a size of
<code>(0.29 0.26 0.26)</code> microns. A voxel is the 3D equivalent of a
pixel and the size specifies the physical dimensions, in
<code>(z, y, x)</code> order for this example. Note the size of the
voxels in z ( axial) is larger than the voxel spacing in the xy
dimensions (lateral). Let’s load the data and visualise with Napari:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>cells3d <span class="op">=</span> ski.data.cells3d()</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>viewer.layers.clear()</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>viewer.add_image(data<span class="op">=</span>cells3d, name<span class="op">=</span>[<span class="st">"membrane"</span>, <span class="st">"nucleus"</span>], channel_axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="bu">print</span>(cells3d.shape)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(60, 2, 256, 256)</code></pre>
</div>
<figure><img src="fig/cells3d-slice-napari.png" alt="cell3d slice napari ss" class="figure mx-auto d-block"></figure><p>Note we now have a dimension slice to control which slice we are
visualizing. You can also switch to a 3D rendering of the data:</p>
<figure><img src="fig/cells3d-volume-napari.png" alt="cell3d volume napari ss" class="figure mx-auto d-block"></figure><p>Many of the scikit-image functions you have used throughout this
Lesson work with 3D (or indeed nD) image data. For example lets blur the
nuclei channel using a 3D Gaussian filter and add the result as a
<code>Image</code> Layer to the Viewer:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># extract the nuclei channel</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>nuclei <span class="op">=</span> cells3d[:, <span class="dv">1</span>, :, :]</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co"># store the voxel size as a NumPy array (in microns)</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>voxel_size <span class="op">=</span> np.array([<span class="fl">0.29</span>, <span class="fl">0.26</span>, <span class="fl">0.26</span>])</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co"># get sigma (std) values for each dimension that corresponds to 0.5 microns</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.5</span> <span class="op">/</span> voxel_size</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co"># blur data with 3D Guassian filter</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>blurred_nuclei <span class="op">=</span> ski.filters.gaussian(nuclei, sigma<span class="op">=</span>sigma)</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co"># add to Napari Viewer</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>viewer.add_image(data<span class="op">=</span>blurred_nuclei, name<span class="op">=</span><span class="st">"nucleus_blurred"</span>)</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="bu">print</span>(sigma)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1.72413793 1.92307692 1.92307692]</code></pre>
</div>
<figure><img src="fig/cells3d-blurred-napari.png" alt="cell3d volume napari ss" class="figure mx-auto d-block"></figure><p>Note we have used a different sigma for the z dimension to allow for
the different voxel dimensions, to produce a blur of 0.5 microns in each
axis of real space. space.</p>
<div id="segmenting-objects-in-3d-25-min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="segmenting-objects-in-3d-25-min" class="callout-inner">
<h3 class="callout-title">Segmenting objects in 3D (25 min)</h3>
<div class="callout-content">
<p>Write a workflow which:</p>
<ol style="list-style-type: decimal"><li>Segments the nuclei within <code>skimage.data.cells3d()</code> to
produce a 3D labelled volume.</li>
<li>Add the 3D labelled volume to a Napari Viewer as a
<code>Label</code> Layer.</li>
<li>Calculate the mean volume in microns^3 of all distinct objects
(connected components) in your 3D labelled volume.</li>
</ol><p>You will need to recall concepts from the <a href="07-thresholding.html"><em>Thresholding</em></a> and the <a href="08-connected-components.html"><em>Connected Components
Analysis</em></a> episodes. Hints:</p>
<ul><li>The 3D blurred nuclei volume we have just calculated makes a good
starting point.</li>
<li>
<code>ski.morphology.remove_small_objects()</code> is useful for
removing small objects in masks. In 3D the <code>min_size</code>
parameter specifies the minimum number of voxels a connected component
should contain.</li>
<li>In 3D we typically use <code>connectivity=3</code> (as opposed to
<code>connectivity=2</code> for 2D data).</li>
<li>
<code>ski.measure.regionprops()</code> can be used to calulate the
properties of connected components in 3D. The returned
<code>"area"</code> property gives the volume of each object in
voxels.</li>
</ul></div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Starting with the 3D blurred nuclei volume as our starting point here
is one potential solution that will segment the nuclei and add to the
existing Napari Viewer:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># use an automated Otsu threshold to produce a binary mask of the nuceli</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>t <span class="op">=</span> ski.filters.threshold_otsu(blurred_nuclei)</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>nuclei_mask <span class="op">=</span> blurred_nuclei <span class="op">&gt;</span> t</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="co"># remove objects from the mask smaller than 5 microns^3</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="co"># np.prod(voxel_size) returns the volume of a voxel in microns^3</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>min_size <span class="op">=</span> <span class="dv">5</span> <span class="op">/</span> np.prod(voxel_size)</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>nuclei_mask <span class="op">=</span> ski.morphology.remove_small_objects(nuclei_mask, min_size<span class="op">=</span>min_size, connectivity<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="co"># label 3D connected components</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="co"># we specify connectivity=3 but this is the default behaviour for 3D data</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>nuclei_labels <span class="op">=</span> ski.measure.label(nuclei_mask, connectivity<span class="op">=</span><span class="dv">3</span>, return_num<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="co"># add to Napari Viewer</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>viewer.add_labels(data<span class="op">=</span>nuclei_labels, name<span class="op">=</span><span class="st">"nuclei_labels"</span>)</span></code></pre>
</div>
<figure><img src="fig/cells3d-labels-napari.png" alt="cell3d labels napari ss" class="figure mx-auto d-block"></figure><p>To extract the properties of the connected components we can use
<code>ski.measure.regionprops()</code>:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>props <span class="op">=</span> ski.measure.regionprops(nuclei_labels)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co"># get the cell volumes in pixels as a NumPy array</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>cell_volumes_voxels <span class="op">=</span> np.array([objf[<span class="st">"area"</span>] <span class="cf">for</span> objf <span class="kw">in</span> props])</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co"># get the mean and convert to microns^3</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>cell_volumes_mean <span class="op">=</span> np.mean(cell_volumes_voxels) <span class="op">*</span> np.prod(voxel_size)</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="ss">f"There are </span><span class="sc">{</span><span class="bu">len</span>(cell_volumes_voxels)<span class="sc">}</span><span class="ss"> distinct objects with a mean volume of </span><span class="sc">{</span>cell_volumes_mean<span class="sc">}</span><span class="ss"> microns^3"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="st">'There are 18 distinct objects with a mean volume of 784.6577237777778 microns^3'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="intensity-morphometrics-optional-not-included-in-timing" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="intensity-morphometrics-optional-not-included-in-timing" class="callout-inner">
<h3 class="callout-title">Intensity morphometrics (optional, not included in timing)</h3>
<div class="callout-content">
<p>It is common to want to retrieve properties of connected components
which use the pixel intensities from the original data. For example the
mean, max, min or sum pixel intensity within each object. Modify your
solution from the previous exercise to also retrieve the mean intensity
of the original nuclei channel within each connected component. You may
need to refer to the <code>ski.measure.regionprops()</code> <a href="https://scikit-image.org/docs/stable/api/skimage.measure.html#skimage.measure.regionprops" class="external-link">documentation</a>.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>props <span class="op">=</span> ski.measure.regionprops(nuclei_labels, intensity_image<span class="op">=</span>nuclei)</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="co"># get the cell volumes in pixels as a NumPy array</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>cell_volumes_pixels <span class="op">=</span> np.array([objf[<span class="st">"area"</span>] <span class="cf">for</span> objf <span class="kw">in</span> props])</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="co"># get the mean and convert to microns^3</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>cell_volumes_mean <span class="op">=</span> np.mean(cell_volumes_pixels) <span class="op">*</span> np.prod(voxel_size)</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="co"># mean intensity within each object</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>cell_mean_intensities <span class="op">=</span> np.array([objf[<span class="st">"intensity_mean"</span>] <span class="cf">for</span> objf <span class="kw">in</span> props])</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="ss">f"There are </span><span class="sc">{</span><span class="bu">len</span>(cell_volumes_pixels)<span class="sc">}</span><span class="ss"> distinct objects with a mean volume of </span><span class="sc">{</span>cell_volumes_mean<span class="sc">}</span><span class="ss"> microns^3 and a mean intensity of </span><span class="sc">{</span>np<span class="sc">.</span>mean(cell_mean_intensities)<span class="sc">}</span><span class="ss">"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="st">'There are 18 distinct objects with a mean volume of 784.6577237777778 microns^3 and a mean intensity of 13876.25671914064'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="processing-timelapse-movies">Processing timelapse movies<a class="anchor" aria-label="anchor" href="#processing-timelapse-movies"></a></h2>
<hr class="half-width"><p>Timelapse data consists of an ordered series of images, or frames,
where each image corresponds to a specific point in time.
<code>data/cell_timelapse.tif</code> is a timelapse fluorescence
microscopy movie of cell nuclei with 41 timepoints. There are two cells
at the beginning of the timelapse which both divide, via a process
called mitosis, leaving fours cells at the end. Let’s load the data and
visualise with Napari:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>cell_timelapse <span class="op">=</span> iio.imread(uri<span class="op">=</span><span class="st">"data/cell_timelapse.tif"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>viewer.layers.clear()</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>viewer.add_image(data<span class="op">=</span>cell_timelapse, name<span class="op">=</span><span class="st">"timelapse"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="bu">print</span>(cell_timelapse.shape)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(41, 113, 101)</code></pre>
</div>
<figure><img src="fig/cells-timelapse-napari.png" alt="cell timelapse napari ss" class="figure mx-auto d-block"></figure><p>Note there is a dimension slider to navigate between timepoints and a
playback button to play/pause the movie. When analysing timelapse data
we can use our now familiar image processing functions from
scikit-image. However, unlike volumetric data it is often appropriate to
analyse each timepoint separately as 2D images rather than performing
operations on the 3D NumPy array. To do this we can use a loop to
iterate through timepoints. For example lets calculate the mean
intensity of each frame in the timelapse and plot the results:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co"># empty list to store frame intensitys</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>mean_intensities <span class="op">=</span> []</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="co"># loop through frames </span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="co"># enumerate gives convenient access to both the frame index and the frame</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="cf">for</span> frame_index, frame <span class="kw">in</span> <span class="bu">enumerate</span>(cell_timelapse):</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>  frame_mean <span class="op">=</span> np.mean(frame)</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>  <span class="co"># add frame mean to list</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>  mean_intensities.append(frame_mean)</span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>plt.plot(mean_intensities)</span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>plt.xlabel(<span class="st">"Timepoint"</span>)</span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>plt.ylabel(<span class="st">"Mean frame intensity"</span>)</span></code></pre>
</div>
<figure><img src="fig/cells_timelapse_mean_plot.png" alt="cell timelapse mean plot ss" class="figure mx-auto d-block"></figure><p>We can see that the frame intensity trends up throughout the movie
with dips around timepoint thirty which if you look corresponds to when
the cell divisions are occurring.</p>
<div id="calculating-nuclear-area-over-time-25-min" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="calculating-nuclear-area-over-time-25-min" class="callout-inner">
<h3 class="callout-title">Calculating nuclear area over time (25 min)</h3>
<div class="callout-content">
<p>Create a binary mask (3D boolean NumPy array) segmenting the nuclei
in <code>data/cell_timelapse.tif</code> over time and add this mask to
the Napari Viewer. You do not need to indentify/label individual
objects/nuclei. Record the total area of the nuclei in each frame over
time and plot the results. Hints:</p>
<ul><li>Use a for loop to iterate through timepoints so you can process each
frame separately.</li>
<li>You may find it useful to create a NumPy array for the binary mask
(<code>mask = np.zeros(cell_timelapse.shape, dtype=bool)</code>). This
array should be created outside the loop and filled in within it.</li>
</ul></div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>Here is one potential solution:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># empty list for nuclear areas</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>nuclear_areas <span class="op">=</span> []</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="co"># boolean mask for nuclear mask</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="co"># same shape as original timelapse</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>mask <span class="op">=</span> np.zeros(cell_timelapse.shape, dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a><span class="co"># iterate through timepoints</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a><span class="cf">for</span> frame_index, frame <span class="kw">in</span> <span class="bu">enumerate</span>(cell_timelapse):</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>  <span class="co"># blur the frame to reduce noise</span></span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>  blurred_frame <span class="op">=</span> ski.filters.gaussian(frame, sigma<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>  <span class="co"># threshold with an Otsu approach</span></span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a>  t <span class="op">=</span> ski.filters.threshold_otsu(blurred_frame)</span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>  frame_mask <span class="op">=</span> blurred_frame <span class="op">&gt;</span> t</span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>  <span class="co"># fill in the corresponding frame of our global mask</span></span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a>  mask[frame_index] <span class="op">=</span> frame_mask</span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a>  <span class="co"># append the area of the mask for this frame (the sum)</span></span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a>  nuclear_areas.append(np.<span class="bu">sum</span>(frame_mask))</span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a><span class="co"># add mask to Napari Viewer</span></span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a>viewer.add_labels(data<span class="op">=</span>mask, name<span class="op">=</span><span class="st">"nuclear mask"</span>)</span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a></span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a><span class="co"># plot the nuclear area over time</span></span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb26-24"><a href="#cb26-24" tabindex="-1"></a>plt.plot(nuclear_areas)</span>
<span id="cb26-25"><a href="#cb26-25" tabindex="-1"></a>plt.xlabel(<span class="st">"Timepoint"</span>)</span>
<span id="cb26-26"><a href="#cb26-26" tabindex="-1"></a>plt.ylabel(<span class="st">"Total nuclear area"</span>)</span></code></pre>
</div>
<figure><img src="fig/cells-timelapse-mask-napari.png" alt="cell timelapse mask napari ss" class="figure mx-auto d-block"></figure><figure><img src="fig/cells_timelapse_area_plot.png" alt="cell timelapse area plot ss" class="figure mx-auto d-block"></figure><p>Note the two large drops in area around timepoint thirty
corresponding the division events.</p>
</div>
</div>
</div>
</div>
<div id="tracking-objects-over-time-optional-not-included-in-timing" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="tracking-objects-over-time-optional-not-included-in-timing" class="callout-inner">
<h3 class="callout-title">Tracking objects over time (optional, not included in timing)</h3>
<div class="callout-content">
<p>Tracking is the process of following the trajectories of individual
objects as they move over time. A simple approach to tracking is to find
connected components in a timelapse treating the data as a 3D volume.
This works well if the objects in question are well separated and do not
move sufficiently far between timepoints to break the connectivity of
the 3D (2D + time) connected component. Implement this approach for
<code>data/cell_timelapse.tif</code> and plot the area of each
object/nucleus as it changes over time. How well does this approach
work? Do you think it would be sufficient for more complex data?</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<p>Here is a potential solution:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co"># boolean mask for nuclear mask</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="co"># same shape as original timelapse</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>mask <span class="op">=</span> np.zeros(cell_timelapse.shape, dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>mask <span class="op">=</span> np.zeros(cell_timelapse.shape, dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="co"># iterate through timepoints</span></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a><span class="cf">for</span> time_index, frame <span class="kw">in</span> <span class="bu">enumerate</span>(cell_timelapse):</span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a>  <span class="co"># blur the frame to reduce noise</span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>  blurred_frame <span class="op">=</span> ski.filters.gaussian(frame, sigma<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a>  <span class="co"># threshold with an Otsu approach</span></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a>  t <span class="op">=</span> ski.filters.threshold_otsu(blurred_frame)</span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a>  frame_mask <span class="op">=</span> blurred_frame <span class="op">&gt;</span> t</span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a>  <span class="co"># fill in the corresponding frame of our global mask</span></span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a>  mask[time_index] <span class="op">=</span> frame_mask</span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a><span class="co"># find the objects (connected components) in the 3D (2D + time) mask</span></span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a>labeled_mask, num_ccs <span class="op">=</span> ski.measure.label(mask, connectivity<span class="op">=</span><span class="dv">3</span>, return_num<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a><span class="co"># add labeled objects to Napari Viewer </span></span>
<span id="cb27-19"><a href="#cb27-19" tabindex="-1"></a>viewer.add_labels(data<span class="op">=</span>labeled_mask, name<span class="op">=</span><span class="st">"labeled_mask"</span>)</span>
<span id="cb27-20"><a href="#cb27-20" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" tabindex="-1"></a><span class="co"># plot for area of each object over time</span></span>
<span id="cb27-22"><a href="#cb27-22" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb27-23"><a href="#cb27-23" tabindex="-1"></a>plt.xlabel(<span class="st">"Timepoint"</span>)</span>
<span id="cb27-24"><a href="#cb27-24" tabindex="-1"></a>plt.ylabel(<span class="st">"Nuclear area"</span>)</span>
<span id="cb27-25"><a href="#cb27-25" tabindex="-1"></a><span class="co"># iterate through objects</span></span>
<span id="cb27-26"><a href="#cb27-26" tabindex="-1"></a><span class="cf">for</span> label_index <span class="kw">in</span> <span class="bu">range</span>(num_ccs):</span>
<span id="cb27-27"><a href="#cb27-27" tabindex="-1"></a>  <span class="co"># empty list for area of this object (nucelus) over time</span></span>
<span id="cb27-28"><a href="#cb27-28" tabindex="-1"></a>  nuclear_area <span class="op">=</span> []</span>
<span id="cb27-29"><a href="#cb27-29" tabindex="-1"></a>  <span class="co"># iterate through timepoints and retrieve object areas</span></span>
<span id="cb27-30"><a href="#cb27-30" tabindex="-1"></a>  <span class="cf">for</span> time_index, frame <span class="kw">in</span> <span class="bu">enumerate</span>(labeled_mask):</span>
<span id="cb27-31"><a href="#cb27-31" tabindex="-1"></a>    nuclear_area.append(np.<span class="bu">sum</span>(frame <span class="op">==</span> label_index <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb27-32"><a href="#cb27-32" tabindex="-1"></a>  <span class="co"># add line to plot for this object (nucelus)</span></span>
<span id="cb27-33"><a href="#cb27-33" tabindex="-1"></a>  plt.plot(nuclear_area)</span></code></pre>
</div>
<figure><img src="fig/cells-timelapse-tracking-napari.png" alt="cell timelapse tracking napari ss" class="figure mx-auto d-block"></figure><figure><img src="fig/cells_timelapse_tracking_plot.png" alt="cell timelapse tracking plot ss" class="figure mx-auto d-block"></figure><p>From the plot we can see our approach has worked well for this simple
example. The movie starts with two nuclei which undergo division such
that we have four nuclei at the end of the timelapse. However, for more
complex data our simple tracking approach is likely to fail. If you are
interested in tracking a good starting point could be a Napari plugin
such as <a href="https://www.napari-hub.org/plugins/btrack" class="external-link">btrack</a>
which uses a Bayesian approach to track multiple objects in crowded
fields of views.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>We can access open a Napari n-dimensional image viewer with
<code>viewer = napari.Viewer()</code>.</li>
<li>
<code>Image</code> and <code>Label</code> Layers can be added to a
viewer with <code>viewer.add_image()</code> and
<code>viewer.add_labels()</code> respectively.</li>
<li>Many scikit-image functions such as
<code>ski.filters.gaussian()</code>,
<code>ski.threshold.threshold_otsu()</code>,
<code>ski.measure.label()</code> and
<code>ski.measure.regionprops()</code> work with 3D image data.</li>
<li>We can iterate through time-points to analyse timelapse movies.</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="09-challenges.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="09-challenges.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Capstone Challenge
        </a>
        <a class="chapter-link float-end" href="index.html" rel="next">
          Home
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/datacarpentry/image-processing/edit/main/episodes/10-multidimensional-data.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/datacarpentry/image-processing/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/datacarpentry/image-processing/" class="external-link">Source</a></p>
				<p><a href="https://github.com/datacarpentry/image-processing/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.6" class="external-link">sandpaper (0.16.6)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.4" class="external-link">varnish (1.0.4)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://bear-rsg.github.io/image-processing/10-multidimensional-data.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Multidimensional data",
  "creativeWorkStatus": "active",
  "url": "https://bear-rsg.github.io/image-processing/10-multidimensional-data.html",
  "identifier": "https://bear-rsg.github.io/image-processing/10-multidimensional-data.html",
  "dateCreated": "2017-03-14",
  "dateModified": "2024-01-26",
  "datePublished": "2024-09-03"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

